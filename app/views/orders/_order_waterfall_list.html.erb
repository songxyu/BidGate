
<div class = "orders_container">
	
<% @orders.each do |order| %>
<div class="order_item" id="order_item_<%= order.id %>">
	<% 
		og = order.order_goods[0]
		item_info_text = og.order_item_info_str 
		
		bid_progres = 0
		i_create_time = order.create_time.to_i
		past_time = Time.now.to_i - i_create_time
		total_time =  order.deadline.to_i - i_create_time
		remaining_time =  order.deadline.to_i - Time.now.to_i
		logger.debug "i_create_time="+ i_create_time.to_s + ", past_time=" + past_time.to_s \
				+ ", total_time=" + total_time.to_s + ", remaining_time=" + remaining_time.to_s
				
		if remaining_time <= 0
			bid_progres = 100	
		else		
			bid_progres = total_time <= 0 ? 100 : (past_time * 100.0 / total_time )
			bid_progres = (bid_progres <= 0 || bid_progres>=100) ?  100 : bid_progres;
		end
		
		logger.debug "bid_progres="+ bid_progres.to_s
		
		bid_history_count = order.order_price_histories.count
	%>
	<div class="item_inner_area">
		<div>
			<!-- TODO: should use order.image, by category id? -->
			<%= link_to image_tag('../img/order_item_sample.png', class:"order_image"), order, remote: true %>
						
			<div class="order_cate_row" >
					<div class="div_float_left_border_right">
						<span><%= order.category ?  order.category.name : "" %> </span> 
					</div> 	
					<span><%= order.order_goods[0].name %> </span>			
			</div>
			<div class="row_margin"><span>最新订单竞价:  </span><span class="highlight_text"><%= order.order_price_histories[bid_history_count-1] ? order.order_price_histories[bid_history_count-1].price : "" %> 元 </span></div>
			<div class="row_margin"> <%= bid_history_count %> 个竞拍</div>			
			<div class="row_margin"> 采购: <%= item_info_text %>  </div>
			<div class="algin_right row_margin">  <%= link_to '详情>>', order, remote: true %>  </div>
			<div class="row_margin"> <img src="../img/location.png"> <b> <%= order.location ? order.location.full_location_name : '' %></b>  </div>
			<div class="bid_progressbar_area">
				<div class="bid_progressbar row_margin" data-progressval="<%=bid_progres%>"></div>
				<div class="progress_label" ><img src="../img/ok.png"><span></span></div>
			</div>
			
			<div class="row_margin"> <b> <span class="algin_left"> <%= order.price %> 元 </span> <span class="algin_right"><%= order.deadline ? order.deadline.strftime('%Y-%m-%d %H:%M')  : ""%> </b> </span> </div>
			<div><span class="algin_left">  起拍 </span> <span class="algin_right"> 截止日期 </span> </div>
				
		</div>
	  
	</div>
</div>

<% end %>

</div>


<div class="pagination_area">
<%= paginate @orders, :remote => true  %>
</div>

